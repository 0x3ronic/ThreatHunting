//This detection finds child processes spawning from onenote.exe. Consistent with recent phishing campaigns involving OneNote files containing malicious scripts/shortcuts that execute commands to pull additional malware. 
union DeviceEvents, DeviceProcessEvents
| where InitiatingProcessParentFileName =~ "onenote.exe"
| where InitiatingProcessFileName =~ "wscript.exe" 
or InitiatingProcessFileName =~ "mshta.exe" 
or InitiatingProcessFileName =~ "cscript.exe"
or InitiatingProcessFileName =~ "msiexec.exe"
or InitiatingProcessFileName =~ "powershell.exe"
or InitiatingProcessFileName =~ "powershell_ise.exe"
or InitiatingProcessFileName =~ "cmd.exe"
| where Timestamp > ago(24h)
| sort by Timestamp
//https://www.bleepingcomputer.com/news/security/hackers-now-use-microsoft-onenote-attachments-to-spread-malware/
//https://twitter.com/nosecurething/status/1617598720048263168
